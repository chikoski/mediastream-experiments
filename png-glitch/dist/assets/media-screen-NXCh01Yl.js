import{_ as de}from"./index-B6eKEfOI.js";class he{routes=new Map;root;constructor(t){this.root=t}compsable(t,r){this.routes.set(t,r)}async navigate(t){const r=this.routes.get(t);if(r!=null){const A=await r();this.unmount(),this.root.appendChild(A)}}unmount(){for(const t of this.root.children)this.root.removeChild(t)}}function ge(e,t){t(e)}function x(e){return e}function ie(e){return null}function ce(e=ie,t=x){const r=document.createElement("div");return e(r),t(r)}function pe(e=ie,t=x){return ce(e,r=>(r.classList.add("column"),t(r)))}function se(e=x){const t=document.createElement("video");return e(t)}function ue(e,t,r=x){const A=document.createElement("button");return A.type="button",A.addEventListener("click",t),A.innerText=e,r(A)}function Qe(e=()=>{}){return pe(t=>{const r=se(n=>(n.classList.add("preview"),n));t.appendChild(r);const A=ue("Click to capture",e);t.appendChild(A)})}const G=e=>WebAssembly.compile(typeof Buffer<"u"?Buffer.from(e,"base64"):Uint8Array.from(atob(e),t=>t.charCodeAt(0)));function Be(e,t,r){if(e<t||e>r)throw new TypeError(`must be between ${t} and ${r}`);return e}class D extends Error{constructor(t){const r=typeof t!="string";super(r?`${String(t)} (see error.payload)`:t),Object.defineProperty(this,"payload",{value:t,enumerable:r})}}let H=new DataView(new ArrayBuffer);const f=e=>H.buffer===e.buffer?H:H=new DataView(e.buffer),_=()=>{},we=typeof process<"u"&&process.versions&&process.versions.node;let O;async function re(e){return we?(O=O||await de(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),WebAssembly.compile(await O.readFile(e))):fetch(e).then(WebAssembly.compileStreaming)}function M(e){return typeof FinalizationRegistry>"u"?{unregister(){}}:new FinalizationRegistry(e)}const m=[],I=WebAssembly.instantiate,a=1<<30;function fe(e,t){const r=e[0]&~a;return r===0?(e.push(X),e.push(t),(e.length>>1)-1):(e[0]=e[r],e[r<<1]=X,e[(r<<1)+1]=t,r)}function R(e,t){const r=e[0]&~a;return r===0?(e.push(0),e.push(t|a),(e.length>>1)-1):(e[0]=e[r<<1],e[r<<1]=0,e[(r<<1)+1]=t|a,r)}function Q(e,t){const r=e[t<<1],A=e[(t<<1)+1],n=(A&a)!==0,o=A&~a;if(A===0||r&a)throw new TypeError("Invalid handle");return e[t<<1]=e[0]|a,e[0]=t|a,{rep:o,scope:r,own:n}}let P=[];function me(e,t,r){const A=m[t],o=(A[(e<<1)+1]&a)!==0?A[(e<<1)+1]&~a:Q(A,e).rep;if(ye[r])return o;const c=m[r]||(m[r]=[a,0]),i=fe(c,o);return P.push({rid:r,handle:i}),i}function Ee(e,t,r){const{rep:A}=Q(m[t],e),n=m[r]||(m[r]=[a,0]);return R(n,A)}let X=0;const B=Symbol("handle"),Z=Symbol.dispose||Symbol.for("dispose");function J(e){return e>>>0}function be(e){return e>>>=0,e%=2**8,e}const ye=[!0,!0,!0,!0];let b,u,w,L,d,U,g,$,N,le;const S=[a,0];M(e=>{const{rep:t}=Q(S,e);b[0](t)});m[0]=S;const Ie=R.bind(null,S);function Ce(e){const t=Q(S,e);t.own&&b[0](t.rep)}const T=[a,0];M(e=>{const{rep:t}=Q(T,e);b[1](t)});m[1]=T;const ke=R.bind(null,T);function Fe(e){const t=Q(T,e);t.own&&b[1](t.rep)}const E=[a,0],j=M(e=>{const{rep:t}=Q(E,e);w[6](t)});m[9]=E;const ve=R.bind(null,E);function Ae(){X++}const ne=me;function ae(){X--;for(const{rid:e,handle:t}of P)if(m[e][t<<1]===X)throw new TypeError("borrows not dropped for resource call");P=[]}const h=[a,0],oe=M(e=>{const{rep:t}=Q(h,e);w[5](t)});m[8]=h;const Ge=R.bind(null,h);function Le(e){const t=Q(h,e);t.own&&w[5](t.rep)}function Ue(e){const t=Q(E,e);t.own&&w[6](t.rep)}const q=[a,0];M(e=>{const{rep:t}=Q(q,e);b[0](t)});m[6]=q;function Ze(e){const t=Q(q,e);t.own&&b[0](t.rep)}const K=[a,0];M(e=>{const{rep:t}=Q(K,e);b[1](t)});m[7]=K;function xe(e){const t=Q(K,e);t.own&&b[1](t.rep)}const Me=Ee;class y{constructor(){throw new Error('"ScanLine" resource does not define a constructor')}}y.prototype.getFilterType=function(){var t=this[B];if(!t||!(h[(t<<1)+1]&a))throw new TypeError('Resource error: Not a valid "ScanLine" resource.');var r=h[(t<<1)+1]&~a;const A=d["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.get-filter-type"](r);let n;switch(A){case 0:{n="none";break}case 1:{n="sub";break}case 2:{n="up";break}case 3:{n="average";break}case 4:{n="paeth";break}default:throw new TypeError("invalid discriminant specified for FilterType")}return n};y.prototype.setFilterType=function(t){var r=this[B];if(!r||!(h[(r<<1)+1]&a))throw new TypeError('Resource error: Not a valid "ScanLine" resource.');var A=h[(r<<1)+1]&~a,n=t;let o;switch(n){case"none":{o=0;break}case"sub":{o=1;break}case"up":{o=2;break}case"average":{o=3;break}case"paeth":{o=4;break}default:throw t instanceof Error&&console.error(t),new TypeError(`"${n}" is not one of the cases of filter-type`)}d["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.set-filter-type"](A,o)};y.prototype.size=function(){var t=this[B];if(!t||!(h[(t<<1)+1]&a))throw new TypeError('Resource error: Not a valid "ScanLine" resource.');var r=h[(t<<1)+1]&~a;return d["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.size"](r)>>>0};y.prototype.getPixelAt=function(t){var r=this[B];if(!r||!(h[(r<<1)+1]&a))throw new TypeError('Resource error: Not a valid "ScanLine" resource.');var A=h[(r<<1)+1]&~a;const n=d["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.get-pixel-at"](A,J(t));return Be(n,0,255)};y.prototype.setPixelAt=function(t,r){var A=this[B];if(!A||!(h[(A<<1)+1]&a))throw new TypeError('Resource error: Not a valid "ScanLine" resource.');var n=h[(A<<1)+1]&~a;d["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.set-pixel-at"](n,J(t),be(r))};y.prototype.read=function(){var t=this[B];if(!t||!(h[(t<<1)+1]&a))throw new TypeError('Resource error: Not a valid "ScanLine" resource.');var r=h[(t<<1)+1]&~a;const A=d["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.read"](r);let n;switch(f(g).getUint8(A+0,!0)){case 0:{var o=f(g).getInt32(A+4,!0),c=f(g).getInt32(A+8,!0),i=new Uint8Array(g.buffer.slice(o,o+c*1));n={tag:"ok",val:i};break}case 1:{n={tag:"err",val:void 0};break}default:throw new TypeError("invalid variant discriminant for expected")}if($(A),n.tag==="err")throw new D(n.val);return n.val};y.prototype.write=function(t){var r=this[B];if(!r||!(h[(r<<1)+1]&a))throw new TypeError('Resource error: Not a valid "ScanLine" resource.');var A=h[(r<<1)+1]&~a,n=t,o=n.byteLength,c=N(0,0,1,o*1),i=new Uint8Array(n.buffer||n,n.byteOffset,o*1);new Uint8Array(g.buffer,c,o*1).set(i),d["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.write"](A,c,o)};class k{constructor(){throw new Error('"Png" resource does not define a constructor')}}k.prototype.getScanLines=function(){var t=this[B];if(!t||!(E[(t<<1)+1]&a))throw new TypeError('Resource error: Not a valid "Png" resource.');var r=E[(t<<1)+1]&~a;const A=d["chikoski:glitch-art/png-glitchable@0.3.4#[method]png.get-scan-lines"](r);var n=f(g).getInt32(A+4,!0),o=f(g).getInt32(A+0,!0),c=[];for(let l=0;l<n;l++){const p=o+l*4;var i=f(g).getInt32(p+0,!0),s=new.target===y?this:Object.create(y.prototype);Object.defineProperty(s,B,{writable:!0,value:i}),oe.register(s,i,s),Object.defineProperty(s,Z,{writable:!0,value:function(){oe.unregister(s),Q(h,i),s[Z]=_,s[B]=null,w[5](h[(i<<1)+1]&~a)}}),c.push(s)}return le(A),c};k.prototype.read=function(){var t=this[B];if(!t||!(E[(t<<1)+1]&a))throw new TypeError('Resource error: Not a valid "Png" resource.');var r=E[(t<<1)+1]&~a;const A=d["chikoski:glitch-art/png-glitchable@0.3.4#[method]png.read"](r);let n;switch(f(g).getUint8(A+0,!0)){case 0:{var o=f(g).getInt32(A+4,!0),c=f(g).getInt32(A+8,!0),i=new Uint8Array(g.buffer.slice(o,o+c*1));n={tag:"ok",val:i};break}case 1:{n={tag:"err",val:void 0};break}default:throw new TypeError("invalid variant discriminant for expected")}if($(A),n.tag==="err")throw new D(n.val);return n.val};k.create=function(t){var r=t,A=r.byteLength,n=N(0,0,1,A*1),o=new Uint8Array(r.buffer||r,r.byteOffset,A*1);new Uint8Array(g.buffer,n,A*1).set(o);const c=d["chikoski:glitch-art/png-glitchable@0.3.4#[static]png.create"](n,A);let i;switch(f(g).getUint8(c+0,!0)){case 0:{var s=f(g).getInt32(c+4,!0),l=new.target===k?this:Object.create(k.prototype);Object.defineProperty(l,B,{writable:!0,value:s}),j.register(l,s,l),Object.defineProperty(l,Z,{writable:!0,value:function(){j.unregister(l),Q(E,s),l[Z]=_,l[B]=null,w[6](E[(s<<1)+1]&~a)}}),i={tag:"ok",val:l};break}case 1:{i={tag:"err",val:void 0};break}default:throw new TypeError("invalid variant discriminant for expected")}if(i.tag==="err")throw new D(i.val);return i.val};function We(e,t,r){var A=e,n=A.byteLength,o=N(0,0,1,n*1),c=new Uint8Array(A.buffer||A,A.byteOffset,n*1);new Uint8Array(g.buffer,o,n*1).set(c);const i=d["chikoski:glitch-art/bridge-to-png-glitchable@0.3.4#create"](o,n,J(t),J(r));let s;switch(f(g).getUint8(i+0,!0)){case 0:{var l=f(g).getInt32(i+4,!0),p=new.target===k?this:Object.create(k.prototype);Object.defineProperty(p,B,{writable:!0,value:l}),j.register(p,l,p),Object.defineProperty(p,Z,{writable:!0,value:function(){j.unregister(p),Q(E,l),p[Z]=_,p[B]=null,w[6](E[(l<<1)+1]&~a)}}),s={tag:"ok",val:p};break}case 1:{s={tag:"err",val:void 0};break}default:throw new TypeError("invalid variant discriminant for expected")}if(s.tag==="err")throw new D(s.val);return s.val}const Xe=(()=>{let e=function*(){const i=re(new URL("/assets/png-glitch.core-DG6xMja5.wasm",import.meta.url)),s=G("AGFzbQEAAAABBQFgAX8AAwMCAAAEBQFwAQICBxQDATAAAAExAAEIJGltcG9ydHMBAAoVAgkAIABBABEAAAsJACAAQQERAAALAC8JcHJvZHVjZXJzAQxwcm9jZXNzZWQtYnkBDXdpdC1jb21wb25lbnQHMC4yMTYuMACZAQRuYW1lABMSd2l0LWNvbXBvbmVudDpzaGltAX0CAD9kdG9yLVtleHBvcnRdY2hpa29za2k6Z2xpdGNoLWFydC9wbmctZ2xpdGNoYWJsZUAwLjMuNC1zY2FuLWxpbmUBOWR0b3ItW2V4cG9ydF1jaGlrb3NraTpnbGl0Y2gtYXJ0L3BuZy1nbGl0Y2hhYmxlQDAuMy40LXBuZw"),l=G("AGFzbQEAAAABBQFgAX8AAhoDAAEwAAAAATEAAAAIJGltcG9ydHMBcAECAgkIAQBBAAsCAAEALwlwcm9kdWNlcnMBDHByb2Nlc3NlZC1ieQENd2l0LWNvbXBvbmVudAcwLjIxNi4wABwEbmFtZQAVFHdpdC1jb21wb25lbnQ6Zml4dXBz"),p=re(new URL("/assets/png-glitch.core2-Bq3ORFdt.wasm",import.meta.url)),C=G("AGFzbQEAAAABFgRgAn9/AGADf39/AGADf39/AGABfwADCAcAAQAAAgMDBAUBcAEHBwcoCAEwAAABMQABATIAAgEzAAMBNAAEATUABQE2AAYIJGltcG9ydHMBAApVBwsAIAAgAUEAEQAACw0AIAAgASACQQERAQALCwAgACABQQIRAAALCwAgACABQQMRAAALDQAgACABIAJBBBECAAsJACAAQQURAwALCQAgAEEGEQMACwAvCXByb2R1Y2VycwEMcHJvY2Vzc2VkLWJ5AQ13aXQtY29tcG9uZW50BzAuMjE2LjAAhwQEbmFtZQATEndpdC1jb21wb25lbnQ6c2hpbQHqAwcASGluZGlyZWN0LWNoaWtvc2tpOmdsaXRjaC1hcnQvcG5nLWdsaXRjaGFibGVAMC4zLjQtW21ldGhvZF1zY2FuLWxpbmUucmVhZAFJaW5kaXJlY3QtY2hpa29za2k6Z2xpdGNoLWFydC9wbmctZ2xpdGNoYWJsZUAwLjMuNC1bbWV0aG9kXXNjYW4tbGluZS53cml0ZQJMaW5kaXJlY3QtY2hpa29za2k6Z2xpdGNoLWFydC9wbmctZ2xpdGNoYWJsZUAwLjMuNC1bbWV0aG9kXXBuZy5nZXQtc2Nhbi1saW5lcwNCaW5kaXJlY3QtY2hpa29za2k6Z2xpdGNoLWFydC9wbmctZ2xpdGNoYWJsZUAwLjMuNC1bbWV0aG9kXXBuZy5yZWFkBERpbmRpcmVjdC1jaGlrb3NraTpnbGl0Y2gtYXJ0L3BuZy1nbGl0Y2hhYmxlQDAuMy40LVtzdGF0aWNdcG5nLmNyZWF0ZQU/ZHRvci1bZXhwb3J0XWNoaWtvc2tpOmdsaXRjaC1hcnQvcG5nLWdsaXRjaGFibGVAMC4zLjQtc2Nhbi1saW5lBjlkdG9yLVtleHBvcnRdY2hpa29za2k6Z2xpdGNoLWFydC9wbmctZ2xpdGNoYWJsZUAwLjMuNC1wbmc"),F=G("AGFzbQEAAAABFgRgAn9/AGADf39/AGADf39/AGABfwACMwgAATAAAAABMQABAAEyAAAAATMAAAABNAACAAE1AAMAATYAAwAIJGltcG9ydHMBcAEHBwkNAQBBAAsHAAECAwQFBgAvCXByb2R1Y2VycwEMcHJvY2Vzc2VkLWJ5AQ13aXQtY29tcG9uZW50BzAuMjE2LjAAHARuYW1lABUUd2l0LWNvbXBvbmVudDpmaXh1cHM"),Y=G("AGFzbQEAAAABIQZgAX8Bf2AAAGADf39/AX9gAn9/AGACf38Bf2ADf39/AALHAQoFZmxhZ3MJaW5zdGFuY2UxA38BBWZsYWdzCWluc3RhbmNlMwN/AQZjYWxsZWUIYWRhcHRlcjAAAAhyZXNvdXJjZQplbnRlci1jYWxsAAEIcmVzb3VyY2UPdHJhbnNmZXItYm9ycm93AAIIcmVzb3VyY2UJZXhpdC1jYWxsAAEGY2FsbGVlCGFkYXB0ZXIxAAMGY2FsbGVlCGFkYXB0ZXIyAAAGY2FsbGVlCGFkYXB0ZXIzAAQGY2FsbGVlCGFkYXB0ZXI0AAUDBgUAAwAEBQc4BQhhZGFwdGVyMAAICGFkYXB0ZXIxAAkIYWRhcHRlcjIACghhZGFwdGVyMwALCGFkYXB0ZXI0AAwKkAQFhAEBAX8jAUEBcUUEQAALIwBBAnFFBEAACyMAQX1xJAAQASMAQX5xJAAgAEEGQQAQAiMAQQFyJAAQACEBIwFBfnEkAQJ/AkACQAJAAkACQAJAIAEOBQECAwQFAAsAC0EADAQLQQEMAwtBAgwCC0EDDAELQQQLIwFBAXIkASMAQQJyJAAQAwuAAQAjAUEBcUUEQAALIwBBAnFFBEAACyMAQX1xJAAQASMAQX5xJAAgAEEGQQAQAgJ/AkACQAJAAkACQAJAIAEOBQECAwQFAAsAC0EADAQLQQEMAwtBAgwCC0EDDAELQQQLIwBBAXIkABAEIwFBfnEkASMBQQFyJAEjAEECciQAEAMLVAEBfyMBQQFxRQRAAAsjAEECcUUEQAALIwBBfXEkABABIwBBfnEkACAAQQZBABACIwBBAXIkABAFIQEjAUF+cSQBIAEjAUEBciQBIwBBAnIkABADC1oBAX8jAUEBcUUEQAALIwBBAnFFBEAACyMAQX1xJAAQASMAQX5xJAAgAEEGQQAQAiABIwBBAXIkABAGIQIjAUF+cSQBIAJB/wFxIwFBAXIkASMAQQJyJAAQAwtWACMBQQFxRQRAAAsjAEECcUUEQAALIwBBfXEkABABIwBBfnEkACAAQQZBABACIAEgAkH/AXEjAEEBciQAEAcjAUF+cSQBIwFBAXIkASMAQQJyJAAQAws"),V=G("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"),ee=new WebAssembly.Global({value:"i32",mutable:!0},3),te=new WebAssembly.Global({value:"i32",mutable:!0},3);({exports:b}=yield I(yield s)),{exports:u}=yield I(yield i,{"[export]chikoski:glitch-art/png-glitchable@0.3.4":{"[resource-drop]png":Fe,"[resource-drop]scan-line":Ce,"[resource-new]png":ke,"[resource-new]scan-line":Ie}}),yield I(yield l,{"":{$imports:b.$imports,0:u["chikoski:glitch-art/png-glitchable@0.3.4#[dtor]scan-line"],1:u["chikoski:glitch-art/png-glitchable@0.3.4#[dtor]png"]}}),{exports:w}=yield I(yield C),{exports:L}=yield I(yield Y,{callee:{adapter0:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.get-filter-type"],adapter1:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.set-filter-type"],adapter2:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.size"],adapter3:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.get-pixel-at"],adapter4:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.set-pixel-at"]},flags:{instance1:ee,instance3:te},resource:{"enter-call":Ae,"exit-call":ae,"transfer-borrow":ne}}),{exports:d}=yield I(yield p,{"[export]chikoski:glitch-art/png-glitchable@0.3.4":{"[resource-drop]png":Ue,"[resource-drop]scan-line":Le,"[resource-new]png":ve,"[resource-new]scan-line":Ge},"chikoski:glitch-art/png-glitchable@0.3.4":{"[method]png.get-scan-lines":w[2],"[method]png.read":w[3],"[method]scan-line.get-filter-type":L.adapter0,"[method]scan-line.get-pixel-at":L.adapter3,"[method]scan-line.read":w[0],"[method]scan-line.set-filter-type":L.adapter1,"[method]scan-line.set-pixel-at":L.adapter4,"[method]scan-line.size":L.adapter2,"[method]scan-line.write":w[1],"[resource-drop]png":xe,"[resource-drop]scan-line":Ze,"[static]png.create":w[4]}}),{exports:U}=yield I(yield V,{augments:{"mem1 I32Load8U":(v,W)=>new DataView(d.memory.buffer).getUint8(v+W,!0),"mem1 I32Store":(v,W,z)=>{new DataView(d.memory.buffer).setInt32(v+z,W,!0)},"mem1 I32Store8":(v,W,z)=>{new DataView(d.memory.buffer).setInt8(v+z,W,!0)},"mem1 MemorySize":v=>d.memory.buffer.byteLength/65536},callee:{adapter5:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.read"],adapter6:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]scan-line.write"],adapter7:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]png.get-scan-lines"],adapter8:u["chikoski:glitch-art/png-glitchable@0.3.4#[method]png.read"],adapter9:u["chikoski:glitch-art/png-glitchable@0.3.4#[static]png.create"]},flags:{instance1:ee,instance3:te},memory:{m0:u.memory},post_return:{adapter5:u["cabi_post_chikoski:glitch-art/png-glitchable@0.3.4#[method]png.read"],adapter7:u["cabi_post_chikoski:glitch-art/png-glitchable@0.3.4#[method]png.get-scan-lines"]},realloc:{f0:d.cabi_realloc,f6:u.cabi_realloc},resource:{"enter-call":Ae,"exit-call":ae,"transfer-borrow":ne,"transfer-own":Me}}),yield I(yield F,{"":{$imports:w.$imports,0:U.adapter5,1:U.adapter6,2:U.adapter7,3:U.adapter8,4:U.adapter9,5:d["chikoski:glitch-art/png-glitchable@0.3.4#[dtor]scan-line"],6:d["chikoski:glitch-art/png-glitchable@0.3.4#[dtor]png"]}}),g=d.memory,$=d["cabi_post_chikoski:glitch-art/png-glitchable@0.3.4#[method]png.read"],N=d.cabi_realloc,le=d["cabi_post_chikoski:glitch-art/png-glitchable@0.3.4#[method]png.get-scan-lines"]}(),t,r,A;function n(c){try{let i;do({value:c,done:i}=e.next(c));while(!(c instanceof Promise)&&!i);if(i)if(r)r(c);else return c;t||(t=new Promise((s,l)=>(r=s,A=l))),c.then(n,A)}catch(i){if(A)A(i);else throw i}}const o=n(null);return t||o})();await Xe;const Re={create:We};class Ye{preview;glitched;constructor(t,r){this.preview=t,this.glitched=Je(this.preview.clone(),r)}stop(){for(const t of this.preview.getTracks())t.stop()}}function Je(e,t=()=>{}){const r=e.getVideoTracks()[0];r.addEventListener("ended",t);const A=je(r);return new MediaStream([A,...e.getAudioTracks()])}function je(e){const t=Te(e),r=new MediaStreamTrackProcessor({track:e}),A=new MediaStreamTrackGenerator({kind:"video"}),n=De(t,o=>{const c=Math.floor(50*Math.random()),i=Math.floor(t.height*.5*Math.random())+c;o.getScanLines().forEach((s,l)=>{l%i<c&&s.setFilterType("paeth");const p=l%s.size();s.setPixelAt(p,0)})});return r.readable.pipeThrough(n).pipeTo(A.writable),A}function De(e,t){const r=e.getContext("2d");return new TransformStream({transform(A,n){(async()=>{if(r!=null){performance.mark("start"),r.drawImage(A,0,0);const i=Math.floor(10*Math.random());for(let F=0;F<i;F++){const Y=Math.floor(Math.random()*(e.height-50)),V=Math.floor(Math.random()*(e.height-50));r.drawImage(e,0,Y,e.width,50,0,V,e.width,50)}performance.mark("png:start");const s=r.getImageData(0,0,e.width,e.height);performance.mark("glitch:start");const l=await Ne(s.data.buffer,e.width,e.height,t);performance.mark("glitch:end"),r.drawImage(l,0,0),performance.mark("end");const p=performance.measure("all","start","end"),C=performance.measure("glitch","glitch:start","glitch:end");console.log(`${p.duration},${C.duration}`)}const o=e.transferToImageBitmap(),c=new VideoFrame(o,{timestamp:A.timestamp});A.close(),n.enqueue(c)})()}})}async function Ne(e,t,r,A){const n=new Uint8Array(e);performance.mark("wasm:start"),performance.mark("wasm:create:start");const o=await Re.create(n,t,r);performance.mark("wasm:create:end"),A(o),performance.mark("wasm:read:start");const c=await o.read();performance.mark("wasm:read:end"),performance.mark("wasm:end");const i=performance.measure("wasm","wasm:start","wasm:end"),s=performance.measure("creation","wasm:create:start","wasm:create:end"),l=performance.measure("read","wasm:read:start","wasm:read:end");console.log(`${i.name}: ${i.duration}, ${s.duration}, ${l.duration}`),performance.mark("blob:start");const p=new Blob([c],{type:"image/png"}),C=new Image(t,r);return C.src=URL.createObjectURL(p),new Promise((F,Y)=>{C.onload=()=>{performance.mark("blob:end"),F(C)}})}class Se{width=480;height=360}function Te(e){return Ve(ze(e))}function Ve(e){return new OffscreenCanvas(e.width,e.height)}function ze(e){const t=new Se,r=e.getSettings();return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),t}class He{children=[];appendChild(t){t.style.flexShrink="1",t.style.flexGrow="1",this.children.push(t)}}function Oe(e,t=x){const r=new He;return e(r),ce(A=>{for(const n of r.children)A.appendChild(n)},A=>{A.classList.add("row");const n=Pe(A);return n.style.flexDirection="row",t(A)})}function Pe(e){return e.style.display="flex",e}function _e(e,t){return Oe(r=>{const A=$e(t,!0,n=>(n.style.maxWidth="100%",n));r.appendChild(A)})}function $e(e,t=!0,r=x){const A=se(n=>(n.classList.add("media-stream-viewer"),n));return A.srcObject=e,t&&A.play(),r(A)}function Ke(){const e=document.createElement("div"),t=new he(e);return ge(t,r=>{r.compsable("/",async()=>Qe(()=>{r.navigate("/open")})),r.compsable("/open",async()=>{const A=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!1}),n=new Ye(A,()=>{r.navigate("/")});return _e(n.preview,n.glitched)})}),t.navigate("/"),e}export{Ke as default};
